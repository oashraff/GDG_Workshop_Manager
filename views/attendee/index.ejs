<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="<%= description || 'Discover and book exciting tech workshops at GDG On Campus EUE' %>">
    <meta name="keywords" content="GDG, workshops, tech events, programming, Firebase, Flutter, Android, EUE">
    
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ccircle cx='50' cy='50' r='40' fill='%234285f4'/%3E%3Ctext x='50' y='60' text-anchor='middle' fill='white' font-family='sans-serif' font-size='40' font-weight='bold'%3EG%3C/text%3E%3C/svg%3E">
    <link rel="stylesheet" type="text/css" href="/main.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    
    <title><%= title || 'Upcoming Workshops - GDG EUE' %></title>
    
    <!-- Open Graph Meta Tags for Social Sharing -->
    <meta property="og:title" content="<%= title || 'Upcoming Workshops - GDG EUE' %>">
    <meta property="og:description" content="<%= description || 'Discover and book exciting tech workshops at GDG On Campus EUE' %>">
    <meta property="og:type" content="website">
    <meta name="twitter:card" content="summary_large_image">
</head>
<body>
    <!-- Header Navigation -->
    <header class="header">
        <div class="container">
            <a href="/" class="logo">
                <div class="logo-icon">G</div>
                GDG On Campus EUE
            </a>
            
            <nav class="nav">
                <a href="/attendee" class="nav-link active">Browse Workshops</a>
                <a href="/organiser" class="nav-link">Organiser Access</a>
            </nav>
        </div>
    </header>

    <!-- Main Content -->
    <main>
        <!-- Hero Section -->
        <section class="hero" style="padding: var(--spacing-3xl) 0;">
            <div class="container">
                <h1>Upcoming Tech Workshops</h1>
                <p>Join our hands-on workshops and level up your skills with Google technologies, Firebase, Flutter, Android development, and more.</p>
            </div>
        </section>

        <!-- Filters Section -->
        <section style="background: white; padding: var(--spacing-xl) 0; border-bottom: 1px solid var(--google-grey-200);">
            <div class="container">
                <form method="GET" action="/attendee" id="filter-form">
                    <div style="display: flex; gap: var(--spacing-lg); align-items: end; flex-wrap: wrap;">
                        <!-- Search Filter -->
                        <div class="form-group" style="flex: 1; min-width: 250px; margin-bottom: 0;">
                            <label for="search" class="form-label">
                                <span class="material-icon">search</span>
                                Search Workshops
                            </label>
                            <input 
                                type="text" 
                                id="search" 
                                name="q" 
                                class="form-control" 
                                placeholder="Search by title or description..."
                                value="<%= currentFilters.q || '' %>"
                            >
                        </div>
                        
                        <!-- Tech Stack Filter -->
                        <div class="form-group" style="flex: 0 0 200px; margin-bottom: 0;">
                            <label for="tech" class="form-label">
                                <span class="material-icon">code</span>
                                Technology
                            </label>
                            <select id="tech" name="tech" class="form-control form-select">
                                <option value="">All Technologies</option>
                                <% techStacks.forEach(tech => { %>
                                    <option value="<%= tech %>" <%= currentFilters.tech === tech ? 'selected' : '' %>>
                                        <%= tech %>
                                    </option>
                                <% }); %>
                            </select>
                        </div>
                        
                        <!-- Skill Level Filter -->
                        <div class="form-group" style="flex: 0 0 180px; margin-bottom: 0;">
                            <label for="level" class="form-label">
                                <span class="material-icon">trending_up</span>
                                Skill Level
                            </label>
                            <select id="level" name="level" class="form-control form-select">
                                <option value="">All Levels</option>
                                <option value="1" <%= currentFilters.level === '1' ? 'selected' : '' %>>Beginner</option>
                                <option value="2" <%= currentFilters.level === '2' ? 'selected' : '' %>>Intermediate</option>
                                <option value="3" <%= currentFilters.level === '3' ? 'selected' : '' %>>Advanced</option>
                            </select>
                        </div>
                        
                        <!-- Filter Actions -->
                        <div style="display: flex; gap: var(--spacing-sm); flex-shrink: 0;">
                            <button type="submit" class="btn btn-primary">
                                <span class="material-icon">filter_list</span>
                                Apply Filters
                            </button>
                            <a href="/attendee" class="btn btn-secondary">
                                <span class="material-icon">clear</span>
                                Clear All
                            </a>
                        </div>
                    </div>
                </form>
            </div>
        </section>

        <!-- Workshops Listing -->
        <section style="padding: var(--spacing-3xl) 0;">
            <div class="container">
                <!-- Results Header -->
                <div class="flex flex-between" style="margin-bottom: var(--spacing-xl); align-items: flex-end;">
                    <div>
                        <h2 style="margin-bottom: var(--spacing-sm);">
                            <% if (Object.keys(currentFilters).length > 0) { %>
                                Filtered Results
                            <% } else { %>
                                All Upcoming Workshops
                            <% } %>
                        </h2>
                        <p style="color: var(--google-grey-600); margin: 0;">
                            <span id="results-count"><%= events.length %></span> workshop<%= events.length !== 1 ? 's' : '' %> found
                        </p>
                    </div>
                    
                    <div style="font-size: 0.875rem; color: var(--google-grey-600);">
                        <span class="badge badge-success">GDG Members: Free</span>
                    </div>
                </div>

                <!-- Events Grid -->
                <% if (events && events.length > 0) { %>
                    <div class="grid grid-2" id="events-grid">
                        <% events.forEach(event => { %>
                            <article class="event-card" data-event-id="<%= event.id %>">
                                <div class="event-card-header">
                                    <h3 class="event-title"><%= event.title %></h3>
                                    <div class="event-meta">
                                        <span><span class="material-icon" style="font-size: 1rem; vertical-align: middle;">calendar_today</span> <%= formatDate(event.event_date) %></span>
                                        <span><span class="material-icon" style="font-size: 1rem; vertical-align: middle;">schedule</span> <%= formatTime(event.event_date) %></span>
                                        <span><span class="material-icon" style="font-size: 1rem; vertical-align: middle;">timer</span> <%= Math.floor(event.duration_minutes / 60) %>h <%= event.duration_minutes % 60 %>m</span>
                                    </div>
                                </div>
                                
                                <div class="event-card-body">
                                    <!-- Description -->
                                    <% if (event.description) { %>
                                        <p class="event-description">
                                            <%= event.description %>
                                        </p>
                                    <% } %>
                                    
                                    <!-- Tech Stack -->
                                    <div class="tech-stack">
                                        <% event.tech_stack.forEach(tech => { %>
                                            <span class="tech-tag <%= tech.toLowerCase() %>"><%= tech %></span>
                                        <% }); %>
                                    </div>
                                    
                                    <!-- Skill Level -->
                                    <div style="margin-bottom: var(--spacing-md);">
                                        <span class="skill-badge <%= getSkillLevelClass(event.skill_level) %>">
                                            <%= getSkillLevelName(event.skill_level) %>
                                        </span>
                                    </div>
                                    
                                    <!-- Availability Status -->
                                    <div>
                                        <div style="display: flex; justify-content: space-between; margin-bottom: var(--spacing-xs); font-size: 0.875rem;">
                                            <span>Available Seats</span>
                                            <span>
                                                <% if (event.is_full) { %>
                                                    <span style="color: var(--google-red); font-weight: 500;">Fully Booked</span>
                                                <% } else { %>
                                                    <span style="color: var(--google-green); font-weight: 500;">
                                                        <%= event.available_seats %> remaining
                                                    </span>
                                                <% } %>
                                            </span>
                                        </div>
                                        <div class="progress">
                                            <div 
                                                class="progress-bar" 
                                                style="width: <%= Math.min(((event.confirmed_bookings || 0) / (event.total_capacity || event.max_attendees) * 100), 100) %>%;"
                                                <% if (event.is_full) { %>
                                                    data-full="true"
                                                <% } %>
                                            ></div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="event-card-footer">
                                    <div>
                                        <% if (event.is_full) { %>
                                            <span class="btn btn-secondary btn-small" style="cursor: not-allowed; opacity: 0.6;">
                                                Fully Booked
                                            </span>
                                        <% } else { %>
                                            <span class="btn btn-primary btn-small">
                                                Book Now
                                            </span>
                                        <% } %>
                                        
                                        <span class="badge badge-success" style="margin-left: var(--spacing-sm);">
                                            GDG Free
                                        </span>
                                    </div>
                                    
                                    <div style="font-size: 0.75rem; color: var(--google-grey-600);">
                                        <span class="material-icon" style="font-size: 1rem; vertical-align: middle;">group</span> <%= event.confirmed_bookings || 0 %> registered
                                    </div>
                                </div>
                            </article>
                        <% }); %>
                    </div>
                <% } else { %>
                    <!-- No Results -->
                    <div class="card" style="text-align: center; padding: var(--spacing-3xl);">
                        <div style="font-size: 4rem; margin-bottom: var(--spacing-lg); opacity: 0.5;">
                            <span class="material-icon" style="font-size: 4rem;">search</span>
                        </div>
                        <h3 style="margin-bottom: var(--spacing-md);">No Workshops Found</h3>
                        <% if (Object.keys(currentFilters).length > 0) { %>
                            <p style="color: var(--google-grey-600); margin-bottom: var(--spacing-lg);">
                                No workshops match your current filters. Try adjusting your search criteria or browse all workshops.
                            </p>
                            <a href="/attendee" class="btn btn-primary">View All Workshops</a>
                        <% } else { %>
                            <p style="color: var(--google-grey-600); margin-bottom: var(--spacing-lg);">
                                No workshops are currently scheduled. Check back soon for exciting new events!
                            </p>
                            <a href="mailto:gdg@uol.eue.edu.eg" class="btn btn-primary">Request a Workshop</a>
                        <% } %>
                    </div>
                <% } %>
            </div>
        </section>

        <!-- GDG Membership Info -->
        <section style="background: var(--google-blue-50); padding: var(--spacing-3xl) 0;">
            <div class="container">
                <div class="card" style="background: white; text-align: center;">
                    <div class="card-body">
                        <h3 style="color: var(--google-blue-700); margin-bottom: var(--spacing-md);">
                            Join GDG On Campus EUE
                        </h3>
                        <p style="margin-bottom: var(--spacing-lg); max-width: 600px; margin-left: auto; margin-right: auto;">
                            Become a GDG member with your <strong>@uol.eue.edu.eg</strong> email to access all workshops for free, 
                            connect with the developer community, and get priority booking for popular events.
                        </p>
                        <div class="flex flex-center" style="gap: var(--spacing-lg);">
                            <a href="mailto:gdg@uol.eue.edu.eg?subject=GDG Membership Enquiry" class="btn btn-primary">
                                Join GDG Today
                            </a>
                            <a href="https://developers.google.com/community/gdg" target="_blank" rel="noopener" class="btn btn-outline">
                                Learn About GDG
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="grid grid-2">
                <div>
                    <h4 style="color: white; margin-bottom: var(--spacing-md);">GDG On Campus EUE</h4>
                    <p style="margin-bottom: var(--spacing-md);">
                        Empowering students and developers through hands-on workshops, 
                        community events, and access to cutting-edge Google technologies.
                    </p>
                    <p style="font-size: 0.875rem; opacity: 0.8; margin-bottom: 0;">
                        Academic project by Omar Ashraf Mohammed, April 2025
                    </p>
                </div>
                
                <div>
                    <h4 style="color: white; margin-bottom: var(--spacing-md);">Get Involved</h4>
                    <div style="display: flex; flex-direction: column; gap: var(--spacing-sm);">
                        <a href="mailto:gdg@uol.eue.edu.eg">Contact GDG Team</a>
                        <a href="/organiser">Organiser Portal</a>
                        <a href="https://developers.google.com/community/gdg" target="_blank" rel="noopener">
                            Global GDG Community
                        </a>
                        <a href="https://developers.google.com" target="_blank" rel="noopener">
                            Google for Developers
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </footer>

    <!-- JavaScript for Enhanced UX -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Auto-submit filters on change for better UX
            const filterForm = document.getElementById('filter-form');
            const filterInputs = filterForm.querySelectorAll('select, input[type="text"]');
            
            let filterTimeout;
            
            filterInputs.forEach(input => {
                input.addEventListener('change', function() {
                    // Immediate submit for select elements
                    if (this.tagName === 'SELECT') {
                        filterForm.submit();
                    }
                });
                
                // Debounced submit for text inputs
                if (input.type === 'text') {
                    input.addEventListener('input', function() {
                        clearTimeout(filterTimeout);
                        filterTimeout = setTimeout(() => {
                            filterForm.submit();
                        }, 1000); // 1 second delay
                    });
                }
            });
            
            // Add hover effects to event cards
            const eventCards = document.querySelectorAll('.event-card');
            eventCards.forEach(card => {
                // Add click event listener
                card.addEventListener('click', function() {
                    const eventId = this.getAttribute('data-event-id');
                    window.location.href = `/attendee/event/${eventId}`;
                });
                
                card.addEventListener('mouseenter', function() {
                    this.style.transform = 'translateY(-4px)';
                    this.style.boxShadow = 'var(--shadow-xl)';
                });
                
                card.addEventListener('mouseleave', function() {
                    this.style.transform = 'translateY(0)';
                    this.style.boxShadow = 'var(--shadow-sm)';
                });
            });
            
            // Update progress bars with animation
            const progressBars = document.querySelectorAll('.progress-bar');
            progressBars.forEach(bar => {
                const width = bar.style.width;
                bar.style.width = '0%';
                bar.style.transition = 'width 1s ease-out';
                
                setTimeout(() => {
                    bar.style.width = width;
                }, 100);
                
                // Change color for full events
                if (bar.dataset.full === 'true') {
                    bar.style.background = 'var(--google-red)';
                }
            });
            
            // Accessibility: Add keyboard navigation for event cards
            eventCards.forEach(card => {
                card.setAttribute('tabindex', '0');
                card.setAttribute('role', 'button');
                card.setAttribute('aria-label', `View details for ${card.querySelector('.event-title').textContent}`);
                
                card.addEventListener('keydown', function(e) {
                    if (e.key === 'Enter' || e.key === ' ') {
                        e.preventDefault();
                        this.click();
                    }
                });
            });
            
            // Add loading states
            const buttons = document.querySelectorAll('.btn');
            buttons.forEach(button => {
                button.addEventListener('click', function() {
                    if (this.type === 'submit' || this.closest('form')) {
                        this.style.opacity = '0.7';
                        this.innerHTML += ' <span class="spinner" style="margin-left: var(--spacing-xs);"></span>';
                    }
                });
            });
            
            // Performance: Lazy load images if any
            if ('IntersectionObserver' in window) {
                const imageObserver = new IntersectionObserver((entries, observer) => {
                    entries.forEach(entry => {
                        if (entry.isIntersecting) {
                            const img = entry.target;
                            img.src = img.dataset.src;
                            img.classList.remove('lazy');
                            observer.unobserve(img);
                        }
                    });
                });
                
                document.querySelectorAll('img[data-src]').forEach(img => {
                    imageObserver.observe(img);
                });
            }
            
            console.log('GDG EUE Attendee Interface loaded successfully');
            console.log(`${document.querySelectorAll('.event-card').length} workshops displayed`);
        });
        
        // Service Worker registration for offline support (Progressive Web App)
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/sw.js').catch(err => {
                    console.log('ServiceWorker registration optional for coursework');
                });
            });
        }
    </script>
</body>
</html>
